name: Python CI/CD Workflow

on:
  push:
    branches: [ main ]

  workflow_dispatch:

env:
  PYTHON_VERSION: '3.10'
  
jobs:
  build_and_test:
    name: Build, Test, and Release
    runs-on: ubuntu-latest
    
    steps:
      - name:  Checkout Repository
        uses: actions/checkout@v4

      - name:  Display Committer Information
        run: |
          echo "Workflow Triggered By: ${{ github.event.pusher.name }}"
          echo "Commit Message: ${{ github.event.head_commit.message }}"
          echo "Running on branch: ${{ github.ref }}"
          
      - name:  Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          
      - name: Install Dependencies (наприклад, flake8 для лінтера)
        run: |
          python -m pip install --upgrade pip
          # Якщо у вас є файл requirements.txt, використовуйте його
          # pip install -r requirements.txt
          pip install flake8
          
      - name: Lint with Flake8 (Перевірка якості коду)

        run: flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
        
      - name:  Create GitHub Release
        if: github.ref == 'refs/heads/main'
        uses: softprops/action-gh-release@v2
        with:
       
          tag_name: v${{ format('{0}{1}{2}.{3}', github.event.repository.pushed_at[0], github.event.repository.pushed_at[1], github.event.repository.pushed_at[2], github.run_number) }}
          name: Automated Release (${{ github.run_number }})
          body: |
            Release created automatically upon push to main branch.
            
            Author: ${{ github.event.pusher.name }}
            Commit: ${{ github.event.head_commit.message }}
            
            **Dependencies:** Python ${{ env.PYTHON_VERSION }}
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 
